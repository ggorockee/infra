{{- if .Values.clusterSecretStore.enabled }}
---
# ClusterSecretStore for GCP Secret Manager
# External Secrets Operator가 설치된 후 자동으로 생성됩니다
apiVersion: external-secrets.io/v1beta1
kind: ClusterSecretStore
metadata:
  name: {{ .Values.clusterSecretStore.name }}
  annotations:
    argocd.argoproj.io/sync-wave: "-2"
  labels:
    {{- if .Values.commonLabels }}
    {{- toYaml .Values.commonLabels | nindent 4 }}
    {{- end }}
    app.kubernetes.io/name: cluster-secret-store
    app.kubernetes.io/component: external-secrets
spec:
  provider:
    gcpsm:
      # GCP 프로젝트 ID
      projectID: {{ .Values.clusterSecretStore.gcpProjectID | quote }}

      # Workload Identity를 사용한 인증
      auth:
        workloadIdentity:
          # GKE 클러스터 위치
          clusterLocation: {{ .Values.clusterSecretStore.clusterLocation }}
          # GKE 클러스터 이름
          clusterName: {{ .Values.clusterSecretStore.clusterName }}
          # Kubernetes ServiceAccount 참조
          serviceAccountRef:
            name: {{ .Values.clusterSecretStore.serviceAccount.name }}
            namespace: {{ .Values.clusterSecretStore.serviceAccount.namespace }}
{{- end }}
