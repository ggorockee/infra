#########################################################################
# Hotsao (핫사오) Helm Chart Values
# Subchart 기반 구조: go-scraper, server, web, redis, rabbitmq
#########################################################################

#########################################################################
# Global ExternalSecret Configuration (GCP Secret Manager)
#########################################################################
externalSecret:
  enabled: true
  secretStore: "gcpsm-secret-store"
  secretKey: "hotsao-app-secrets"
  targetSecretName: "hotsao-app-secrets"
  refreshInterval: "1h"

#########################################################################
# Go Scraper - CronJob 기반 핫딜 크롤러
#########################################################################
go-scraper:
  enabled: false
  image:
    repository: ggorockee/hotsao-go-scraper
    pullPolicy: IfNotPresent
    tag: "latest"

  serviceAccount:
    create: true
    automount: true

  podLabels:
    job: hotsao-go-scraper
    service: hotsao-go-scraper

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

  configMap:
    enabled: true
    data:
      TIMEZONE: "Asia/Seoul"
      LOG_LEVEL: "info"

  # ExternalSecret configuration (GCP Secret Manager)
  externalSecret:
    enabled: true
    secretStore: "gcpsm-secret-store"
    secretKey: "hotsao-app-secrets"
    targetSecretName: "hotsao-app-secrets"
    refreshInterval: "1h"

  # Secret configuration
  secret:
    enabled: true
    names:
      - hotsao-app-secrets

  # CronJob configuration
  runner:
    enabled: true
    scrapers:
      - name: ppomppu
        schedule: "0 * * * *"
        timeZone: "Asia/Seoul"

#########################################################################
# Server - Go Fiber v2 API
#########################################################################
server:
  enabled: true
  replicaCount: 2
  image:
    repository: ggorockee/hotsao-server
    pullPolicy: IfNotPresent
    tag: "20251229-abdca6b"

  serviceAccount:
    create: true
    automount: true

  podLabels:
    app: hotsao-server
    service: hotsao-server

  service:
    type: ClusterIP
    port: 3000
    portName: "http"

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

  livenessProbe:
    httpGet:
      path: /healthcheck/live
      port: http
      scheme: HTTP
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /healthcheck/ready
      port: http
      scheme: HTTP
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  startupProbe:
    httpGet:
      path: /healthcheck/ready
      port: http
      scheme: HTTP
    initialDelaySeconds: 0
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 20

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  configMap:
    enabled: true
    data:
      APP_ENV: "production"
      APP_PORT: "3000"

  secret:
    enabled: true
    names:
      - hotsao-app-secrets

  # DB 마이그레이션 Job (비활성화)
  migration:
    enabled: false

#########################################################################
# Web - Next.js Frontend
#########################################################################
web:
  enabled: true
  replicaCount: 2
  image:
    repository: ggorockee/hotsao-web
    pullPolicy: IfNotPresent
    tag: "20251229-809fb37"

  serviceAccount:
    create: true
    automount: true

  podLabels:
    app: hotsao-web
    service: hotsao-web

  service:
    type: ClusterIP
    port: 3000
    portName: "http"

  resources:
    requests:
      cpu: 50m
      memory: 128Mi
    limits:
      cpu: 200m
      memory: 256Mi

  livenessProbe:
    httpGet:
      path: /
      port: http
      scheme: HTTP
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: http
      scheme: HTTP
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  startupProbe:
    httpGet:
      path: /
      port: http
      scheme: HTTP
    initialDelaySeconds: 0
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 12

  # HPA 설정
  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  configMap:
    enabled: true
    data:
      NODE_ENV: "production"
      PORT: "3000"
      NEXT_PUBLIC_API_URL: "https://api.hotsao.com"

  secret:
    enabled: false
    names: []

#########################################################################
# Redis
#########################################################################
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    existingSecret: "hotsao-app-secrets"
    existingSecretPasswordKey: "REDIS_PASSWORD"
  master:
    persistence:
      enabled: false

#########################################################################
# RabbitMQ (공식 이미지 직접 관리)
#########################################################################
rabbitmq:
  enabled: true
  image:
    registry: docker.io
    repository: rabbitmq
    tag: "management-alpine"
  auth:
    existingPasswordSecret: "hotsao-app-secrets"
    existingSecretPasswordKey: "RABBITMQ_PASSWORD"
    username: hotsao
  persistence:
    enabled: false
    size: "8Gi"
