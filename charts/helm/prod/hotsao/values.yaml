#########################################################################
# Hotsao (핫사오) Helm Chart Values
# Subchart 기반 구조: go-scraper, server, web, redis, rabbitmq
#########################################################################

#########################################################################
# Global ExternalSecret Configuration (GCP Secret Manager)
#########################################################################
externalSecret:
  enabled: true
  secretStore: "gcpsm-secret-store"
  secretKey: "hotsao-app-secrets"
  targetSecretName: "hotsao-app-secrets"
  refreshInterval: "1h"

#########################################################################
# Go Scraper - CronJob 기반 핫딜 크롤러
#########################################################################
go-scraper:
  enabled: true
  image:
    repository: ggorockee/hotsao-go-scraper
    pullPolicy: IfNotPresent
    tag: "20260106-4e4358e"

  serviceAccount:
    create: true
    automount: true

  podLabels:
    job: hotsao-go-scraper
    service: hotsao-go-scraper

  resources:
    requests:
      cpu: 550m
      memory: 800Mi
    limits:
      cpu: 800m
      memory: 1200Mi

  configMap:
    enabled: true
    data:
      TIMEZONE: "Asia/Seoul"
      LOG_LEVEL: "info"
      ENABLE_IMAGE_CDN: "false"

  # ExternalSecret configuration (GCP Secret Manager)
  # Umbrella chart 레벨의 hotsao-app-secrets 사용
  externalSecret:
    enabled: false
    secretStore: "gcpsm-secret-store"
    secretKey: "hotsao-app-secrets"
    targetSecretName: "hotsao-app-secrets"
    refreshInterval: "1h"

  # Secret configuration - umbrella chart의 hotsao-app-secrets 참조
  secret:
    enabled: true
    names:
      - hotsao-app-secrets

  # CronJob configuration
  runner:
    enabled: true
    scrapers:
      - name: ppomppu
        schedule: "*/1 * * * *"  # 1분마다 실행
        failedJobsHistoryLimit: 1
        timeZone: "Asia/Seoul"
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 200m
            memory: 512Mi
      - name: ruliweb
        schedule: "*/1 * * * *"  # 1분마다 실행
        failedJobsHistoryLimit: 1
        timeZone: "Asia/Seoul"
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 200m
            memory: 512Mi
      - name: clien
        schedule: "*/1 * * * *"  # 1분마다 실행
        failedJobsHistoryLimit: 1
        timeZone: "Asia/Seoul"
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 200m
            memory: 512Mi
      - name: quasarzone
        schedule: "*/1 * * * *"  # 1분마다 실행
        failedJobsHistoryLimit: 1
        timeZone: "Asia/Seoul"
        resources:
          requests:
            cpu: 100m
            memory: 256Mi
          limits:
            cpu: 200m
            memory: 512Mi
      - name: arcalive
        schedule: "*/1 * * * *"  # 1분마다 실행
        failedJobsHistoryLimit: 1
        timeZone: "Asia/Seoul"
        # chromedp 사용으로 리소스를 더 많이 사용 (기본값 사용)

#########################################################################
# Admin - Django Admin Panel
#########################################################################
admin:
  enabled: true
  replicaCount: 1
  revisionHistoryLimit: 1
  image:
    repository: ggorockee/hotsao-admin
    pullPolicy: IfNotPresent
    tag: "20260104-89d697c"

  serviceAccount:
    create: true
    automount: true

  podAnnotations:
    sidecar.istio.io/inject: "false"

  podLabels:
    app: hotsao-admin
    service: hotsao-admin

  service:
    type: ClusterIP
    port: 8000
    portName: "http"

  resources:
    requests:
      cpu: 50m
      memory: 120Mi
    limits:
      cpu: 150m
      memory: 256Mi

  livenessProbe:
    httpGet:
      path: /healthz
      port: http
      scheme: HTTP
    initialDelaySeconds: 15
    periodSeconds: 20
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /healthz
      port: http
      scheme: HTTP
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  startupProbe:
    httpGet:
      path: /healthz
      port: http
      scheme: HTTP
    initialDelaySeconds: 15
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 30

  autoscaling:
    enabled: false
    minReplicas: 1
    maxReplicas: 3
    targetCPUUtilizationPercentage: 80
    targetMemoryUtilizationPercentage: 90

  configMap:
    enabled: true
    data:
      DJANGO_SETTINGS_MODULE: "settings.settings"
      DJANGO_ALLOWED_HOSTS: "*"

  secret:
    enabled: true
    names:
      - hotsao-app-secrets

#########################################################################
# Server - Go Fiber v2 API
#########################################################################
server:
  enabled: true
  replicaCount: 2
  revisionHistoryLimit: 1
  image:
    repository: ggorockee/hotsao-server
    pullPolicy: IfNotPresent
    tag: "20260106-4e4358e"

  serviceAccount:
    create: true
    automount: true

  podLabels:
    app: hotsao-server
    service: hotsao-server

  service:
    type: ClusterIP
    port: 3000
    portName: "http"

  resources:
    requests:
      cpu: 30m
      memory: 80Mi
    limits:
      cpu: 100m
      memory: 150Mi

  livenessProbe:
    httpGet:
      path: /v1/healthcheck/live
      port: http
      scheme: HTTP
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /v1/healthcheck/ready
      port: http
      scheme: HTTP
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  startupProbe:
    httpGet:
      path: /v1/healthcheck/ready
      port: http
      scheme: HTTP
    initialDelaySeconds: 0
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 20

  autoscaling:
    enabled: true
    minReplicas: 2
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  configMap:
    enabled: true
    data:
      APP_ENV: "production"
      APP_PORT: "3000"

  secret:
    enabled: true
    names:
      - hotsao-app-secrets

  # DB 마이그레이션 Job (비활성화)
  migration:
    enabled: false

#########################################################################
# Web - Next.js Frontend
#########################################################################
web:
  enabled: true
  replicaCount: 1
  revisionHistoryLimit: 1
  image:
    repository: ggorockee/hotsao-web
    pullPolicy: IfNotPresent
    tag: "20260107-521468d"

  serviceAccount:
    create: true
    automount: true

  podLabels:
    app: hotsao-web
    service: hotsao-web

  service:
    type: ClusterIP
    port: 3000
    portName: "http"

  resources:
    requests:
      cpu: 40m
      memory: 110Mi
    limits:
      cpu: 100m
      memory: 200Mi

  livenessProbe:
    httpGet:
      path: /
      port: http
      scheme: HTTP
    initialDelaySeconds: 10
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  readinessProbe:
    httpGet:
      path: /
      port: http
      scheme: HTTP
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    failureThreshold: 3

  startupProbe:
    httpGet:
      path: /
      port: http
      scheme: HTTP
    initialDelaySeconds: 0
    periodSeconds: 5
    timeoutSeconds: 3
    failureThreshold: 12

  # HPA 설정
  autoscaling:
    enabled: true
    minReplicas: 1
    maxReplicas: 5
    targetCPUUtilizationPercentage: 70
    targetMemoryUtilizationPercentage: 80

  configMap:
    enabled: true
    data:
      NODE_ENV: "production"
      PORT: "3000"
      NEXT_PUBLIC_API_URL: "https://api.hotsao.com"
      INTERNAL_API_URL: "http://hotsao-server.hotsao.svc.cluster.local:3000"

  secret:
    enabled: true
    names:
      - hotsao-app-secrets

#########################################################################
# Redis
#########################################################################
redis:
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    existingSecret: "hotsao-app-secrets"
    existingSecretPasswordKey: "REDIS_PASSWORD"
  master:
    revisionHistoryLimit: 1
    persistence:
      enabled: false
    resources:
      requests:
        cpu: 20m
        memory: 64Mi
      limits:
        cpu: 100m
        memory: 128Mi

#########################################################################
# RabbitMQ (공식 이미지 직접 관리)
#########################################################################
rabbitmq:
  enabled: true
  revisionHistoryLimit: 1
  image:
    registry: docker.io
    repository: rabbitmq
    tag: "management-alpine"
  auth:
    existingPasswordSecret: "hotsao-app-secrets"
    existingSecretPasswordKey: "RABBITMQ_PASSWORD"
    username: hotsao
  persistence:
    enabled: false
    size: "8Gi"
  resources:
    requests:
      cpu: 50m
      memory: 180Mi
    limits:
      cpu: 200m
      memory: 384Mi
