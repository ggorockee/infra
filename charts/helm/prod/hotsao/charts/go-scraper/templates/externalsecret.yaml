{{- if .Values.externalSecret.enabled }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: {{ include "go-scraper.fullname" . }}
  labels:
    {{- include "go-scraper.labels" . | nindent 4 }}
spec:
  refreshInterval: {{ .Values.externalSecret.refreshInterval }}
  secretStoreRef:
    kind: ClusterSecretStore
    name: {{ .Values.externalSecret.secretStore }}
  target:
    name: {{ .Values.externalSecret.targetSecretName }}
    creationPolicy: Owner
    template:
      engineVersion: v2
      data:
        # Database credentials
        DB_HOST: "{{`{{ .DB_HOST }}`}}"
        DB_PORT: "{{`{{ .DB_PORT }}`}}"
        DB_NAME: "{{`{{ .DB_NAME }}`}}"
        DB_USER: "{{`{{ .DB_USER }}`}}"
        DB_PASSWORD: "{{`{{ .DB_PASSWORD }}`}}"

        # Redis credentials
        REDIS_HOST: "{{`{{ .REDIS_HOST }}`}}"
        REDIS_PORT: "{{`{{ .REDIS_PORT }}`}}"
        REDIS_PASSWORD: "{{`{{ .REDIS_PASSWORD }}`}}"

        # RabbitMQ credentials
        RABBITMQ_HOST: "{{`{{ .RABBITMQ_HOST }}`}}"
        RABBITMQ_PORT: "{{`{{ .RABBITMQ_PORT }}`}}"
        RABBITMQ_USER: "{{`{{ .RABBITMQ_USER }}`}}"
        RABBITMQ_PASSWORD: "{{`{{ .RABBITMQ_PASSWORD }}`}}"

        # Naver API credentials
        NAVER_CLIENT_ID: "{{`{{ .NAVER_CLIENT_ID }}`}}"
        NAVER_CLIENT_SECRET: "{{`{{ .NAVER_CLIENT_SECRET }}`}}"

        # API credentials
        API_SECRET_KEY: "{{`{{ .API_SECRET_KEY }}`}}"
        JWT_SECRET: "{{`{{ .JWT_SECRET }}`}}"
  dataFrom:
    - extract:
        key: {{ .Values.externalSecret.secretKey }}
{{- end }}
