# OpenTelemetry Collector Values for Production

replicaCount: 1
revisionHistoryLimit: 3

image:
  repository: otel/opentelemetry-collector-contrib
  pullPolicy: IfNotPresent
  tag: "0.91.0"

serviceAccount:
  create: true
  automount: true

podLabels:
  app: otel-collector
  environment: production

resources:
  requests:
    cpu: 100m
    memory: 128Mi
  limits:
    cpu: 500m
    memory: 512Mi

# OpenTelemetry Collector 설정
config:
  receivers:
    otlp:
      protocols:
        http:
          endpoint: 0.0.0.0:4318
        grpc:
          endpoint: 0.0.0.0:4317

  processors:
    batch:
      timeout: 10s
      send_batch_size: 1024

    resource:
      attributes:
        - key: environment
          value: production
          action: upsert
        - key: cluster
          value: woohalabs-prod-gke
          action: upsert

  exporters:
    # Prometheus exporter (Prometheus가 스크레이핑)
    prometheus:
      endpoint: 0.0.0.0:8889
      namespace: reviewmaps
      const_labels:
        environment: production
        cluster: woohalabs-prod-gke

    # SigNoz로 계속 전송 (기존 모니터링 유지)
    # SIGNOZ_ENDPOINT는 필요시 Secret에서 주입
    # otlphttp/signoz:
    #   endpoint: ${SIGNOZ_ENDPOINT}
    #   compression: gzip

    # 디버깅용 로깅
    logging:
      verbosity: detailed
      sampling_initial: 5
      sampling_thereafter: 200

  extensions:
    health_check:
      endpoint: 0.0.0.0:13133

  service:
    extensions: [health_check]
    pipelines:
      metrics:
        receivers: [otlp]
        processors: [batch, resource]
        exporters: [prometheus, logging]

# Prometheus ServiceMonitor 설정
serviceMonitor:
  enabled: true
  interval: 30s
  scrapeTimeout: 10s
  labels:
    release: kube-prometheus-stack

# Secret 설정 (SigNoz 엔드포인트 등)
secret:
  enabled: false
  names: []
  # - otel-collector-secrets
